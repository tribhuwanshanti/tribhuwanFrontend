<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Viewer | STSSS</title>
    
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Prevent selection and context menu to discourage copying */
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        #pdf-container { overflow-y: auto; height: 100vh; background: #525659; display: flex; flex-direction: column; align-items: center; padding-top: 60px; }
        canvas { margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    </style>
</head>
<body class="bg-gray-800 m-0 overflow-hidden" oncontextmenu="return false;">

    <!-- Toolbar -->
    <div class="fixed top-0 w-full bg-gray-900 text-white h-14 flex items-center justify-between px-4 z-50 shadow-md">
        <div class="font-medium truncate max-w-xs">Study Material Viewer</div>
        <div class="flex items-center space-x-4">
            <button onclick="zoomOut()" class="p-2 hover:bg-gray-700 rounded"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg></button>
            <span id="zoomLevel" class="text-sm">100%</span>
            <button onclick="zoomIn()" class="p-2 hover:bg-gray-700 rounded"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button>
        </div>
        <div>
            <button onclick="window.close()" class="p-2 hover:bg-red-600 rounded text-sm">Close</button>
        </div>
    </div>

    <!-- Container -->
    <div id="pdf-container">
        <div id="loader" class="mt-20 text-white">Loading Document...</div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const url = urlParams.get('src');
        
        if(!url) {
            document.getElementById('loader').innerText = "No document specified.";
        } else {
            let pdfDoc = null;
            let scale = 1.2;
            const container = document.getElementById('pdf-container');

            async function renderPage(num) {
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale });
                
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                container.appendChild(canvas);
                await page.render(renderContext).promise;
            }

            async function loadPdf() {
                try {
                    const loadingTask = pdfjsLib.getDocument(url);
                    pdfDoc = await loadingTask.promise;
                    document.getElementById('loader').style.display = 'none';
                    
                    for(let i = 1; i <= pdfDoc.numPages; i++) {
                        await renderPage(i);
                    }
                } catch(e) {
                    console.error(e);
                    document.getElementById('loader').innerText = "Error loading document. It might be restricted.";
                    document.getElementById('loader').classList.add('text-red-400');
                }
            }

            function zoomIn() {
                scale += 0.2;
                updateZoom();
            }

            function zoomOut() {
                if(scale > 0.4) scale -= 0.2;
                updateZoom();
            }

            function updateZoom() {
                document.getElementById('zoomLevel').innerText = Math.round(scale * 100) + '%';
                container.innerHTML = ''; // Clear existing
                if(pdfDoc) {
                    for(let i = 1; i <= pdfDoc.numPages; i++) {
                        renderPage(i);
                    }
                }
            }

            loadPdf();
        }
    </script>
</body>
</html>
